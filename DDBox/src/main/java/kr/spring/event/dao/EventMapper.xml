<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.spring.event.dao.EventMapper">
	<!-- 이벤트 글 등록 -->
	<insert id="insertEvent" parameterType="Event_listVO">
		INSERT INTO event_list(
			event_num,
			event_title,
			event_content,
			event_type,
			event_photo1,
			event_photo2,
			event_start,
			event_end,
			mem_num)
		VALUES(
			eventlist_seq.nextval,
			#{event_title},
			#{event_content},
			#{event_type},
			#{event_photo1,jdbcType=VARCHAR},
			#{event_photo2,jdbcType=VARCHAR},
			#{event_start},
			#{event_end},
			#{mem_num})
	</insert>
	
	<!-- 게시판 글의 총개수/검색 개수 -->
	<select id="selectRowCount" parameterType="map" resultType="integer">
		SELECT
			COUNT(*)
		FROM event_list JOIN member USING(mem_num)
	</select>
	
	<!-- 이벤트글 전체 목록/검색 목록 -->
	<select id="selectList" parameterType="map" resultType="Event_listVO">
		SELECT *
		FROM (
			SELECT
				a.*,
				rownum rnum
			FROM (
				SELECT
					event_num,
					<![CDATA[
					REPLACE(REPLACE(event_title,'<','&lt;'),'>','&gt;') event_title,
					]]>
					event_start,
					event_end,
					event_type,
					event_photo1
				FROM event_list
				ORDER BY event_num DESC
			)a
		)
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>
	
	<!-- 글 상세 -->
	<select id="selectEvent" parameterType="integer">
		SELECT
			*
		FROM event_list
		JOIN member USING(mem_num)
		WHERE event_num=#{event_num}
	</select>
	<insert id="insertEntry" parameterType="Entry_listVO">
		INSERT INTO entry_list(
			entry_num,
			event_num,
			event_point,
			event_type,
			mem_num,
			entry_date)
		VALUES (
			entrylist_seq.nextval,
			#{event_num},
			#{event_point},
			#{event_type},
			#{mem_num},
			SYSDATE)
	</insert>
</mapper>
 





